<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CPG Retail Services: Competitive Intelligence Dashboard</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
  :root {
    --bg-primary: #0a0e1a;
    --bg-secondary: #111827;
    --bg-card: #1a2235;
    --border-color: #2a3654;
    --text-primary: #f0f4ff;
    --text-secondary: #8b9cc7;
    --text-muted: #5b6b8f;
    --accent-blue: #3b82f6;
    --accent-cyan: #22d3ee;
    --accent-green: #10b981;
    --accent-amber: #f59e0b;
    --accent-red: #ef4444;
    --accent-purple: #8b5cf6;
    --accent-pink: #ec4899;
    --accent-orange: #f97316;
    --accent-teal: #14b8a6;
    --accent-indigo: #6366f1;
    --shadow-lg: 0 10px 40px rgba(0,0,0,0.4);
    --shadow-glow: 0 0 20px rgba(59,130,246,0.15);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Inter',-apple-system,sans-serif; background:var(--bg-primary); color:var(--text-primary); overflow-x:hidden; line-height:1.5; }

  .dashboard-header { background:linear-gradient(135deg,#0f172a 0%,#1e293b 50%,#0f172a 100%); border-bottom:1px solid var(--border-color); padding:24px 40px; position:sticky; top:0; z-index:100; backdrop-filter:blur(20px); }
  .header-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
  .header-brand { display:flex; align-items:center; gap:14px; }
  .header-logo { width:40px; height:40px; background:linear-gradient(135deg,#3b82f6,#1d4ed8); border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:18px; color:white; }
  .header-title { font-size:20px; font-weight:700; letter-spacing:-0.3px; }
  .header-subtitle { font-size:12px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1.5px; font-weight:500; }
  .header-meta { text-align:right; font-size:12px; color:var(--text-muted); }
  .header-meta span { color:var(--accent-cyan); font-weight:600; }

  .nav-tabs { display:flex; gap:4px; margin-top:16px; overflow-x:auto; scrollbar-width:none; padding-bottom:2px; }
  .nav-tabs::-webkit-scrollbar { display:none; }
  .nav-tab { padding:8px 18px; border-radius:8px; font-size:13px; font-weight:500; color:var(--text-secondary); background:transparent; border:1px solid transparent; cursor:pointer; white-space:nowrap; transition:all 0.2s ease; }
  .nav-tab:hover { color:var(--text-primary); background:rgba(59,130,246,0.08); }
  .nav-tab.active { color:var(--accent-cyan); background:rgba(34,211,238,0.08); border-color:rgba(34,211,238,0.25); }

  .section { display:none; padding:32px 40px; max-width:1600px; margin:0 auto; }
  .section.active { display:block; }
  .section-title { font-size:24px; font-weight:700; margin-bottom:6px; letter-spacing:-0.5px; }
  .section-desc { color:var(--text-secondary); font-size:14px; margin-bottom:28px; }

  .grid-4 { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:28px; }
  .grid-3 { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-bottom:28px; }
  .grid-2 { display:grid; grid-template-columns:repeat(2,1fr); gap:16px; margin-bottom:28px; }
  @media(max-width:1200px){ .grid-4{grid-template-columns:repeat(2,1fr);} .grid-3{grid-template-columns:1fr 1fr;} }
  @media(max-width:768px){ .grid-4,.grid-3,.grid-2{grid-template-columns:1fr;} .section{padding:20px 16px;} .dashboard-header{padding:16px;} }

  .card { background:var(--bg-card); border:1px solid var(--border-color); border-radius:14px; padding:22px; transition:all 0.25s ease; }
  .card:hover { border-color:rgba(59,130,246,0.3); box-shadow:var(--shadow-glow); transform:translateY(-1px); }
  .card-title { font-size:12px; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-muted); font-weight:600; margin-bottom:10px; }
  .card-value { font-size:32px; font-weight:800; letter-spacing:-1px; line-height:1.1; }
  .card-detail { font-size:13px; color:var(--text-secondary); margin-top:6px; }

  .stat-mini { display:flex; align-items:center; gap:14px; }
  .stat-mini .stat-icon { width:44px; height:44px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; }
  .stat-mini .stat-content { flex:1; }

  .company-card { background:var(--bg-card); border:1px solid var(--border-color); border-radius:14px; padding:24px; cursor:pointer; transition:all 0.3s ease; position:relative; overflow:hidden; }
  .company-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; background:var(--card-accent,var(--accent-blue)); opacity:0; transition:opacity 0.3s ease; }
  .company-card:hover::before { opacity:1; }
  .company-card:hover { border-color:rgba(59,130,246,0.3); transform:translateY(-2px); box-shadow:var(--shadow-lg); }
  .company-card .company-name { font-size:17px; font-weight:700; margin-bottom:3px; }
  .company-card .company-type { font-size:12px; color:var(--text-muted); margin-bottom:14px; }
  .company-card .company-stats { display:flex; gap:20px; margin-bottom:14px; }
  .company-card .stat-label { font-size:10px; text-transform:uppercase; letter-spacing:1px; color:var(--text-muted); font-weight:600; }
  .company-card .stat-val { font-size:16px; font-weight:700; }
  .company-card .company-tags { display:flex; flex-wrap:wrap; gap:5px; }
  .company-tag { padding:3px 9px; border-radius:6px; font-size:10px; font-weight:600; text-transform:uppercase; letter-spacing:0.5px; background:rgba(59,130,246,0.1); color:var(--accent-blue); border:1px solid rgba(59,130,246,0.2); }

  .chart-container { background:var(--bg-card); border:1px solid var(--border-color); border-radius:14px; padding:24px; }
  .chart-title { font-size:15px; font-weight:700; margin-bottom:4px; }
  .chart-subtitle { font-size:12px; color:var(--text-muted); margin-bottom:18px; }

  .hbar-chart { display:flex; flex-direction:column; gap:10px; }
  .hbar-row { display:flex; align-items:center; gap:12px; }
  .hbar-label { width:140px; font-size:12px; font-weight:500; flex-shrink:0; text-align:right; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .hbar-track { flex:1; height:26px; background:rgba(255,255,255,0.04); border-radius:6px; overflow:hidden; }
  .hbar-fill { height:100%; border-radius:6px; transition:width 1s ease; display:flex; align-items:center; padding:0 10px; font-size:11px; font-weight:600; color:white; white-space:nowrap; }
  .hbar-value { width:90px; font-size:12px; font-weight:600; text-align:right; flex-shrink:0; }

  /* Positioning Charts - SVG based */
  .pos-chart-svg { width:100%; background:rgba(0,0,0,0.2); border-radius:10px; }

  .data-table { width:100%; border-collapse:collapse; font-size:13px; }
  .data-table th { text-align:left; padding:10px 14px; background:rgba(255,255,255,0.03); font-size:10px; text-transform:uppercase; letter-spacing:1px; color:var(--text-muted); font-weight:600; border-bottom:1px solid var(--border-color); }
  .data-table td { padding:12px 14px; border-bottom:1px solid rgba(255,255,255,0.03); color:var(--text-secondary); vertical-align:top; }
  .data-table tr:hover td { background:rgba(255,255,255,0.02); }

  .tier-badge { display:inline-flex; padding:3px 10px; border-radius:20px; font-size:11px; font-weight:700; letter-spacing:0.5px; }
  .tier-1 { background:rgba(59,130,246,0.15); color:var(--accent-blue); border:1px solid rgba(59,130,246,0.3); }
  .tier-2 { background:rgba(139,92,246,0.15); color:var(--accent-purple); border:1px solid rgba(139,92,246,0.3); }
  .tier-3 { background:rgba(245,158,11,0.15); color:var(--accent-amber); border:1px solid rgba(245,158,11,0.3); }

  .timeline { position:relative; padding-left:24px; }
  .timeline::before { content:''; position:absolute; left:8px; top:4px; bottom:4px; width:2px; background:var(--border-color); }
  .timeline-item { position:relative; padding:8px 0 16px 18px; }
  .timeline-item::before { content:''; position:absolute; left:-20px; top:13px; width:10px; height:10px; border-radius:50%; background:var(--accent-blue); border:2px solid var(--bg-card); }
  .timeline-date { font-size:11px; color:var(--accent-cyan); font-weight:600; text-transform:uppercase; letter-spacing:0.5px; }
  .timeline-content { font-size:13px; color:var(--text-secondary); margin-top:2px; }

  .heatmap-table { width:100%; border-collapse:collapse; font-size:12px; }
  .heatmap-table thead,.heatmap-table tbody { display:table; width:100%; table-layout:fixed; }
  .heatmap-table th { padding:10px 6px; text-align:center; font-size:10px; text-transform:uppercase; letter-spacing:0.5px; color:var(--text-muted); font-weight:600; border-bottom:1px solid var(--border-color); }
  .heatmap-table th:first-child { text-align:left; width:150px; }
  .heatmap-table td { padding:8px 6px; text-align:center; border-bottom:1px solid rgba(255,255,255,0.02); }
  .heatmap-table td:first-child { text-align:left; font-weight:600; font-size:12px; }
  .heat-cell { display:inline-flex; align-items:center; justify-content:center; width:34px; height:28px; border-radius:6px; font-size:11px; font-weight:700; }
  .heat-5 { background:rgba(16,185,129,0.25); color:#34d399; }
  .heat-4 { background:rgba(16,185,129,0.15); color:#6ee7b7; }
  .heat-3 { background:rgba(245,158,11,0.15); color:#fbbf24; }
  .heat-2 { background:rgba(239,68,68,0.12); color:#fca5a5; }
  .heat-1 { background:rgba(239,68,68,0.08); color:#f87171; }
  .heat-0 { background:rgba(255,255,255,0.02); color:var(--text-muted); }

  .legend { display:flex; gap:16px; flex-wrap:wrap; margin-bottom:18px; }
  .legend-item { display:flex; align-items:center; gap:6px; font-size:12px; color:var(--text-secondary); }
  .legend-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }

  .swot-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .swot-card { background:var(--bg-card); border:1px solid var(--border-color); border-radius:14px; padding:22px; }
  .swot-card h3 { font-size:14px; font-weight:700; text-transform:uppercase; letter-spacing:1px; margin-bottom:14px; }
  .swot-strengths h3 { color:var(--accent-green); }
  .swot-weaknesses h3 { color:var(--accent-red); }
  .swot-opportunities h3 { color:var(--accent-blue); }
  .swot-threats h3 { color:var(--accent-amber); }
  .swot-card ul { list-style:none; }
  .swot-card li { padding:5px 0; font-size:13px; color:var(--text-secondary); display:flex; gap:8px; align-items:flex-start; }
  .swot-card li::before { content:''; width:5px; height:5px; border-radius:50%; flex-shrink:0; margin-top:7px; }
  .swot-strengths li::before { background:var(--accent-green); }
  .swot-weaknesses li::before { background:var(--accent-red); }
  .swot-opportunities li::before { background:var(--accent-blue); }
  .swot-threats li::before { background:var(--accent-amber); }

  .stacked-bar-container { display:flex; flex-direction:column; gap:14px; }
  .stacked-bar-label { font-size:12px; font-weight:600; margin-bottom:4px; }
  .stacked-bar-track { display:flex; height:24px; border-radius:6px; overflow:hidden; }
  .stacked-segment { height:100%; display:flex; align-items:center; justify-content:center; font-size:10px; font-weight:600; color:white; overflow:hidden; }

  .strength-badge { display:inline-flex; padding:4px 10px; border-radius:6px; font-size:12px; font-weight:600; background:rgba(16,185,129,0.12); color:var(--accent-green); border:1px solid rgba(16,185,129,0.2); }
  .weakness-badge { display:inline-flex; padding:4px 10px; border-radius:6px; font-size:12px; font-weight:600; background:rgba(239,68,68,0.1); color:var(--accent-red); border:1px solid rgba(239,68,68,0.2); }
  .mod-badge { display:inline-flex; padding:4px 10px; border-radius:6px; font-size:12px; font-weight:600; background:rgba(245,158,11,0.12); color:var(--accent-amber); border:1px solid rgba(245,158,11,0.2); }

  .modal-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter:blur(8px); z-index:1000; justify-content:center; align-items:flex-start; padding:40px; overflow-y:auto; }
  .modal-overlay.active { display:flex; }
  .modal-content { background:var(--bg-secondary); border:1px solid var(--border-color); border-radius:16px; width:100%; max-width:900px; padding:36px; position:relative; margin-top:20px; box-shadow:var(--shadow-lg); }
  .modal-close { position:absolute; top:16px; right:16px; width:36px; height:36px; background:rgba(255,255,255,0.05); border:1px solid var(--border-color); border-radius:8px; color:var(--text-secondary); font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.2s ease; }
  .modal-close:hover { background:rgba(239,68,68,0.15); color:var(--accent-red); }
  .modal-header { margin-bottom:24px; padding-bottom:20px; border-bottom:1px solid var(--border-color); }
  .modal-company-name { font-size:28px; font-weight:800; letter-spacing:-0.5px; }
  .modal-company-type { font-size:14px; color:var(--text-secondary); margin-top:4px; }
  .modal-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-bottom:24px; }
  .modal-stat { background:rgba(255,255,255,0.03); border-radius:10px; padding:14px; }
  .modal-stat-label { font-size:10px; text-transform:uppercase; letter-spacing:1px; color:var(--text-muted); font-weight:600; margin-bottom:4px; }
  .modal-stat-value { font-size:18px; font-weight:700; }
  .modal-section-title { font-size:14px; font-weight:700; color:var(--accent-cyan); text-transform:uppercase; letter-spacing:1px; margin:20px 0 10px; }
  .modal-list { list-style:none; }
  .modal-list li { padding:6px 0; font-size:14px; color:var(--text-secondary); display:flex; gap:8px; }
  .modal-list li::before { content:''; width:6px; height:6px; border-radius:50%; background:var(--accent-blue); flex-shrink:0; margin-top:7px; }

  .filter-bar { display:flex; gap:8px; margin-bottom:20px; flex-wrap:wrap; }
  .filter-btn { padding:6px 14px; border-radius:20px; font-size:12px; font-weight:500; color:var(--text-secondary); background:rgba(255,255,255,0.04); border:1px solid var(--border-color); cursor:pointer; transition:all 0.2s ease; }
  .filter-btn:hover { border-color:var(--accent-blue); color:var(--text-primary); }
  .filter-btn.active { background:rgba(59,130,246,0.12); border-color:var(--accent-blue); color:var(--accent-blue); }

  /* US Map */
  .us-map-container { position:relative; }
  .us-map-container svg { width:100%; height:auto; }
  .us-map-container svg path { stroke:#1a2235; stroke-width:0.5; transition:all 0.2s ease; cursor:pointer; }
  .us-map-container svg path:hover { stroke:white; stroke-width:1.5; filter:brightness(1.3); }
  .map-tooltip { position:absolute; background:#1e293b; border:1px solid var(--border-color); border-radius:8px; padding:10px 14px; font-size:12px; pointer-events:none; z-index:50; display:none; box-shadow:var(--shadow-lg); max-width:280px; }
  .map-legend { display:flex; flex-wrap:wrap; gap:10px; margin-top:14px; }
  .map-legend-item { display:flex; align-items:center; gap:6px; font-size:11px; color:var(--text-secondary); }
  .map-legend-swatch { width:14px; height:14px; border-radius:3px; flex-shrink:0; }

  @keyframes fadeInUp { from{opacity:0;transform:translateY(16px);} to{opacity:1;transform:translateY(0);} }
  .animate-in { animation:fadeInUp 0.5s ease forwards; }

  @media print { body{background:white;color:#1a1a1a;} .dashboard-header{position:static;} .section{display:block!important;page-break-inside:avoid;} .card,.chart-container,.company-card{border-color:#ddd;box-shadow:none;background:white;} }
</style>
</head>
<body>
<header class="dashboard-header">
  <div class="header-top">
    <div class="header-brand">
      <div class="header-logo">CI</div>
      <div>
        <div class="header-title">CPG & Retail Services: Competitive Landscape</div>
        <div class="header-subtitle">Brokerage, Merchandising & Retail Labor Services</div>
      </div>
    </div>
    <div class="header-meta">Strategy Session Briefing<br><span>February 2026</span> | Confidential</div>
  </div>
  <nav class="nav-tabs" id="navTabs">
    <button class="nav-tab active" data-section="overview">Market Overview</button>
    <button class="nav-tab" data-section="players">Player Profiles</button>
    <button class="nav-tab" data-section="positioning">Competitive Positioning</button>
    <button class="nav-tab" data-section="geomap">Geographic Coverage</button>
    <button class="nav-tab" data-section="capabilities">Capability Matrix</button>
    <button class="nav-tab" data-section="consolidation">M&A & Consolidation</button>
    <button class="nav-tab" data-section="technology">Technology & Innovation</button>
    <button class="nav-tab" data-section="workforce">Workforce & Models</button>
    <button class="nav-tab" data-section="strategic">Strategic Implications</button>
    <button class="nav-tab" data-section="executive">Executive Summary</button>
  </nav>
</header>

<!-- All section HTML is generated dynamically by JS below -->
<div id="app"></div>

<div class="modal-overlay" id="companyModal">
  <div class="modal-content" id="modalContent">
    <button class="modal-close" id="modalClose">&times;</button>
    <div id="modalBody"></div>
  </div>
</div>

<script>
// ===================== DATA =====================
const companies = [
  {
    id:'advantage', name:'Advantage Solutions', type:'National Full-Service Platform (Public: ADV)',
    tier:'tier-1', color:'#e74c3c', hq:'Clayton, MO', founded:1987,
    ownership:'Public (NASDAQ: ADV); Leonard Green & CVC Capital ~74%',
    headcount:69000, headcountLabel:'69,000', revenueRange:'$3.57B (FY24)', revenueMid:3566,
    services:['HQ Sales & Brokerage','Retail Merchandising','Experiential / Demos (Costco)','Private Brand (Daymon)','Retail Media','Digital Commerce','Analytics & Insights','Omnicommerce'],
    channels:['Grocery','Mass','Club','Drug','Dollar','C-Store','Foodservice','E-Commerce'],
    geo:'US, Canada, 45+ countries',
    geoScore:5,
    states:['ALL'],
    strengths:['Largest CPG broker by revenue ($3.57B)','Preferred partner: Costco, Walmart, Amazon','Daymon private brand leadership','69K employees, 100K+ retail locations','Public company transparency','Experiential segment growing 11% YoY'],
    weaknesses:['Net loss of $378M in FY2024','Net debt ~$1.6B, leverage 4.4x','Stock at $0.87 (from $12+ at SPAC)','Branded Services declining 4-12%','75% part-time workforce','Altman Z-Score near zero (distress zone)'],
    recentMoves:['Comprehensive rebrand to YourADV.com (Sep 2024)','Divested Jun Group for $185M (Jun 2024)','Divested 10+ non-core businesses (~$280M proceeds)','Genpact + TCS digital transformation deals (Jan 2024)','HQ relocated from Irvine, CA to Clayton, MO','Retail media launch at scale (2025)'],
    ceo:'Dave Peacock (CEO since Feb 2023)',
    techScore:4, serviceBreadth:90, scaleScore:92, specialization:45, nationalReach:88,
    threatScale:5, threatTech:3, threatMA:2, threatClient:5, threatTalent:4, threatOverall:'Critical'
  },
  {
    id:'acosta', name:'Acosta Group', type:'Full-Service Agency Collective',
    tier:'tier-1', color:'#3b82f6', hq:'Jacksonville, FL', founded:1927,
    ownership:'PE-backed (Elliott, Oaktree, Davidson Kempner)',
    headcount:60000, headcountLabel:'60,000+', revenueRange:'$5B-$8B (est)', revenueMid:6500,
    services:['HQ Sales & Brokerage','Retail Merchandising','Experiential Marketing','Foodservice','Digital Commerce','E-Commerce (Amazon)','Sampling & Demo','Retail Media'],
    channels:['Grocery','Mass','Club','Drug','Dollar','C-Store','Foodservice','E-Commerce'],
    geo:'US, Canada, UK, Australia',
    geoScore:4,
    states:['ALL'],
    strengths:['Largest agency collective post-Crossmark deal','8 distinct agency brands under one roof','Zero funded debt post-bankruptcy','Largest shared retail workforce in NA'],
    weaknesses:['Bankruptcy history (2019)','Massive integration risk (Crossmark + Product Connections)','Employee NPS of -13','Labor-intensive margins'],
    recentMoves:['Acquired Crossmark + Product Connections (Jul 2024)','Acquired Dee Set Group UK (Sep 2024)','Strategic alliance with CommerceIQ (Jan 2026)','Acquired The Culinary Edge (2025)'],
    ceo:'Brian Wynne',
    techScore:4, serviceBreadth:95, scaleScore:95, specialization:40, nationalReach:90,
    threatScale:5, threatTech:4, threatMA:5, threatClient:5, threatTalent:4, threatOverall:'Critical'
  },
  {
    id:'crossmark', name:'Crossmark', type:'HQ Sales & Retail Solutions (Acosta subsidiary)',
    tier:'tier-1', color:'#6366f1', hq:'Plano, TX', founded:1905,
    ownership:'Acosta Group (acquired Jul 2024)',
    headcount:25000, headcountLabel:'25,000+', revenueRange:'$1B-$2B (est)', revenueMid:1500,
    services:['HQ Sales & Brokerage','Retail Merchandising','Analytics (Accelerator)','Marketing Services','E-Commerce'],
    channels:['Grocery','Mass','Club','Drug','Dollar','C-Store','HBC'],
    geo:'US, Canada',
    geoScore:3,
    states:['ALL'],
    strengths:['100+ year heritage','Walmart Preferred Services Provider','Target Preferred Partner','Accelerator AI analytics platform','Canadian operations'],
    weaknesses:['Now subsidiary -- loss of independence','Multiple ownership changes in 6 years','Leadership scores in bottom 20% for Dallas area','Customer NPS of -15'],
    recentMoves:['Acquired by Acosta Group (Jul 2024)','Integration into Acosta collective underway','Accelerator analytics platform continued'],
    ceo:'Jami McDermid (President)',
    techScore:4, serviceBreadth:75, scaleScore:75, specialization:55, nationalReach:75,
    threatScale:4, threatTech:3, threatMA:2, threatClient:4, threatTalent:3, threatOverall:'High'
  },
  {
    id:'driveline', name:'Driveline', type:'Retail Merchandising & Technology',
    tier:'tier-2', color:'#8b5cf6', hq:'Coppell, TX', founded:1999,
    ownership:'PE-backed (Lake Capital); Apr 2025 ownership event',
    headcount:15000, headcountLabel:'15,000+', revenueRange:'$500M-$1.5B', revenueMid:900,
    services:['Retail Resets & Remodels','New Store Setups','DSD Support','LiDAR Space Capture','AI Analytics','ShelfOptix Robotics','Fixture Installation'],
    channels:['Grocery','Mass','Dollar','Home Improvement','Convenience'],
    geo:'US (all 50 states)',
    geoScore:2,
    states:['ALL'],
    strengths:['W-2 workforce model (not 1099)','Proprietary SmartPMX technology stack','200,000+ retail locations serviced','Dollar General exclusive partner','ShelfOptix robotics first-mover'],
    weaknesses:['Dollar General client concentration','Employee satisfaction below average','No international presence','No HQ sales / brokerage capability'],
    recentMoves:['ShelfOptix launch with Brain Corp (Sep 2025)','Ownership change (Apr 2025)','Continued SmartPMX development'],
    ceo:'Randy Wilson',
    techScore:5, serviceBreadth:45, scaleScore:60, specialization:85, nationalReach:60,
    threatScale:3, threatTech:5, threatMA:2, threatClient:3, threatTalent:3, threatOverall:'High'
  },
  {
    id:'cafortune', name:'C.A. Fortune', type:'Full-Service Consumer Brand Agency',
    tier:'tier-3', color:'#10b981', hq:'Chicago, IL', founded:1983,
    ownership:'Private consortium (Carlin Group + ESM Ferolie)',
    headcount:600, headcountLabel:'~600', revenueRange:'$128M-$500M', revenueMid:300,
    services:['Sales & Brokerage','Brand Incubation','Marketing (SRW)','Retail Activation (Gotham)','E-Commerce','Multicultural (DTH)','Analytics'],
    channels:['Grocery','Natural','Mass','Club','Drug','C-Store','Dollar','Alt'],
    geo:'US (national via C.A. banner)',
    geoScore:2,
    states:['ALL'],
    strengths:['True end-to-end CPG agency','No PE debt burden','Natural/specialty heritage','Aggressive M&A without PE backing','Multicultural capability (DTH)','Inc. 5000 growth company'],
    weaknesses:['Scale gap vs. Tier 1 players','Rapid acquisition integration risk','Complex federated governance','Limited international presence'],
    recentMoves:['SRW Agency merger (Mar 2024)','Gotham by Trax acquisition (Jan 2024)','DirecToHispanic acquisition (Mar 2025)','Leadership promotions (Feb 2025)'],
    ceo:'Tyler Lowell (Managing Partner & CEO)',
    techScore:3, serviceBreadth:80, scaleScore:25, specialization:70, nationalReach:55,
    threatScale:2, threatTech:2, threatMA:4, threatClient:3, threatTalent:3, threatOverall:'Moderate'
  },
  {
    id:'joh', name:'JOH', type:'Regional Broker + E-Commerce',
    tier:'tier-3', color:'#f59e0b', hq:'Billerica, MA', founded:1956,
    ownership:"Private, family-owned (O'Hare family)",
    headcount:700, headcountLabel:'~550-825', revenueRange:'$150M-$210M', revenueMid:180,
    services:['HQ Sales & Brokerage','Retail Merchandising','Category Management','E-Commerce (KartSmartr)','Marketing','Emerging Brand Advisory (SIX60)'],
    channels:['Grocery','Drug','Mass','Club','C-Store','Dollar','Specialty'],
    geo:'US (NE core + national via OSMG)',
    geoScore:2,
    states:['ME','NH','VT','MA','RI','CT','NY','NJ','PA','DE','MD','VA','DC'],
    strengths:['Family-owned stability (no PE pressure)','Deep NE retail relationships (70 years)','National reach via OSMG','KartSmartr e-commerce capability','SIX60 emerging brand pipeline'],
    weaknesses:['Regional concentration in NE','Scale limitations vs. national players','OSMG dependency for non-core regions','Technology investment capacity constraints'],
    recentMoves:["CEO succession -- Matt O'Hare (Jan 2025)",'SIX60 Partners acquisition (2025)','Integrated Commerce Marketing launch','KartSmartr expansion'],
    ceo:"Matt O'Hare (CEO, Jan 2025)",
    techScore:3, serviceBreadth:65, scaleScore:22, specialization:60, nationalReach:45,
    threatScale:1, threatTech:2, threatMA:2, threatClient:2, threatTalent:2, threatOverall:'Low'
  },
  {
    id:'schraad', name:'Schraad', type:'Regional CPG Broker',
    tier:'tier-3', color:'#14b8a6', hq:'Oklahoma City, OK', founded:1967,
    ownership:'Private, family-owned (2nd gen)',
    headcount:170, headcountLabel:'~140-200', revenueRange:'$10M-$35M', revenueMid:25,
    services:['HQ Sales & Brokerage','Retail Merchandising','Category Management','Marketing & Promotion','Fresh/Produce'],
    channels:['Grocery','Mass','Drug','Dollar','Natural','Wholesale'],
    geo:'US (26+ states, Central/South)',
    geoScore:2,
    states:['OK','TX','AR','KS','MO','NE','IA','LA','MS','AL','TN','KY','IN','OH','WV','VA','NC','SC','GA','FL','SD','ND','MN','WI','IL','CO'],
    strengths:['Multi-generational retail relationships','Deep H-E-B, Hy-Vee, AWG expertise','National reach via OSMG','Strong fresh produce capabilities'],
    weaknesses:['Small regional scale','Limited investment capacity','OSMG dependency outside core','AWG wholesale concentration'],
    recentMoves:['Expanded Target Grocery capability','Fresh/produce department expansion','2026 annual meeting "Evolve" theme'],
    ceo:'Bill Schraad (President & CEO)',
    techScore:2, serviceBreadth:50, scaleScore:10, specialization:55, nationalReach:35,
    threatScale:1, threatTech:1, threatMA:1, threatClient:2, threatTalent:1, threatOverall:'Low'
  },
  {
    id:'empire', name:'Empire', type:'Kroger-Exclusive Broker',
    tier:'tier-2', color:'#ec4899', hq:'Cincinnati, OH', founded:1980,
    ownership:'Private, family-owned (Harris family)',
    headcount:1500, headcountLabel:'1,000-2,500', revenueRange:'~$257M', revenueMid:257,
    services:['Kroger HQ Sales','Retail Merchandising','Category Management (84.51)','Private Label (Our Brands)','Supply Chain','AI-Driven Merchandising'],
    channels:['Kroger (all banners)'],
    geo:'US (all 18 Kroger divisions)',
    geoScore:2,
    states:['OH','KY','IN','MI','WV','VA','TN','GA','SC','NC','TX','CO','OR','WA','AZ','NV','UT','IL','WI','AK'],
    strengths:['Only broker with office inside Kroger HQ','45-year Kroger relationship','Preferred Broker / Our Brands Preferred Vendor','Below-industry turnover rate','Deep 84.51 integration'],
    weaknesses:['100% Kroger concentration','No diversification across other retailers','Opaque financials','Succession risk (founding family)'],
    recentMoves:['GoSpotCheck/FORM partnership (2020)','AI-driven merchandising investment','Kroger Houston Broker of the Year','Newsweek Greatest Workplaces for Women 2025'],
    ceo:'Bob Halpin (President)',
    techScore:3, serviceBreadth:40, scaleScore:35, specialization:95, nationalReach:30,
    threatScale:2, threatTech:2, threatMA:1, threatClient:3, threatTalent:2, threatOverall:'Moderate'
  },
  {
    id:'trax', name:'Trax', type:'Retail Tech / Computer Vision',
    tier:'tier-2', color:'#22d3ee', hq:'Singapore', founded:2010,
    ownership:'PE-backed (Gemspring Capital post-merger); SoftBank Vision Fund',
    headcount:830, headcountLabel:'~830', revenueRange:'~$170M', revenueMid:170,
    services:['Computer Vision / Image Recognition','On-Device IR (AR)','Shelf Monitoring','Signal-Based Merchandising','Shopkick (Shopper Engagement)','Market Measurement'],
    channels:['Cross-channel tech layer'],
    geo:'80+ countries globally',
    geoScore:5,
    states:['ALL'],
    strengths:['Pioneer in retail computer vision','$1.14B total funding raised','30 of top 50 global CPGs as customers','On-Device IR innovation (offline, 3D)','FORM merger adds field ops platform','Massive global footprint'],
    weaknesses:['Multiple CEO changes and layoffs','Declining market share (29.6% to 27.3%)','Complex merger integration','Profitability concerns'],
    recentMoves:['FORM + Trax IR merger (Feb 2026)','On-Device IR launch (Jul 2025)','$50M Deutsche Bank venture debt (Jan 2024)','Gary Laben appointed CEO (Mar 2024)'],
    ceo:'Ali Moosani (CEO, combined FORM+Trax)',
    techScore:5, serviceBreadth:35, scaleScore:30, specialization:95, nationalReach:50,
    threatScale:2, threatTech:5, threatMA:3, threatClient:2, threatTalent:2, threatOverall:'High'
  },
  {
    id:'productconnections', name:'Product Connections', type:'In-Store Demo & Experiential Marketing',
    tier:'tier-2', color:'#f97316', hq:'Bentonville, AR', founded:2017,
    ownership:'Acosta Group (acquired Jul 2024)',
    headcount:14000, headcountLabel:'14,000+', revenueRange:'$200M-$500M (est)', revenueMid:350,
    services:["In-Store Product Demos","Experiential Marketing","Digital & Omnichannel","Shopper Marketing","Content Production","Sam's Club 360 Programs"],
    channels:["Club (Sam's Club)","Grocery","Mass"],
    geo:'US + Puerto Rico',
    geoScore:2,
    states:['ALL'],
    strengths:["Sam's Club dominance",'800+ brand clients, 23+ retailers','Patented demo carts, in-house production','Turnkey omnichannel demo capability','Acosta Group ecosystem access'],
    weaknesses:["Sam's Club concentration risk",'Acquisition integration risk','Mixed employee reviews','Competes with sibling Mosaic brand'],
    recentMoves:['Acquired by Acosta Group (Jul 2024)','Part of CommerceIQ strategic alliance ecosystem'],
    ceo:'John Jason Gramling (President)',
    techScore:3, serviceBreadth:40, scaleScore:55, specialization:80, nationalReach:55,
    threatScale:3, threatTech:2, threatMA:1, threatClient:3, threatTalent:2, threatOverall:'Moderate'
  },
  {
    id:'trux', name:'TruX', type:'Retail Merchandising Startup',
    tier:'tier-3', color:'#a855f7', hq:'Ashburn, VA', founded:2024,
    ownership:'Private LLC (startup)',
    headcount:125, headcountLabel:'50-200 (est)', revenueRange:'<$10M (est)', revenueMid:5,
    services:['Category Resets','New Item Placement','Store Openings & Remodels','Shelf Strategy & Analytics','Surge Support','TruTech Platform'],
    channels:['Grocery'],
    geo:'US (Northeast)',
    geoScore:1,
    states:['MA','CT','VA'],
    strengths:['Founded by former SAS Retail EVP','Lean / no middle management model','TruTech proprietary platform','Agility advantage vs. incumbents'],
    weaknesses:['Very early stage / limited track record','Small scale','Legal dispute with SAS Retail','Single known client (Big Y)','Northeast only'],
    recentMoves:['Company formation (2024-2025)','Big Y Foods program win','Lawsuit vs. SAS Retail (filed Dec 2025, dismissed Jan 2026)'],
    ceo:'Adam Weissman (Founder)',
    techScore:2, serviceBreadth:30, scaleScore:5, specialization:50, nationalReach:10,
    threatScale:1, threatTech:2, threatMA:1, threatClient:1, threatTalent:1, threatOverall:'Low'
  }
];

// State abbreviation to name mapping
const stateNames = {AL:'Alabama',AK:'Alaska',AZ:'Arizona',AR:'Arkansas',CA:'California',CO:'Colorado',CT:'Connecticut',DE:'Delaware',FL:'Florida',GA:'Georgia',HI:'Hawaii',ID:'Idaho',IL:'Illinois',IN:'Indiana',IA:'Iowa',KS:'Kansas',KY:'Kentucky',LA:'Louisiana',ME:'Maine',MD:'Maryland',MA:'Massachusetts',MI:'Michigan',MN:'Minnesota',MS:'Mississippi',MO:'Missouri',MT:'Montana',NE:'Nebraska',NV:'Nevada',NH:'New Hampshire',NJ:'New Jersey',NM:'New Mexico',NY:'New York',NC:'North Carolina',ND:'North Dakota',OH:'Ohio',OK:'Oklahoma',OR:'Oregon',PA:'Pennsylvania',RI:'Rhode Island',SC:'South Carolina',SD:'South Dakota',TN:'Tennessee',TX:'Texas',UT:'Utah',VT:'Vermont',VA:'Virginia',WA:'Washington',WV:'West Virginia',WI:'Wisconsin',WY:'Wyoming',DC:'Washington DC'};
const allStates = Object.keys(stateNames);

// US State SVG paths (simplified)
const statePaths = {"AL":"M628,396 L628,453 L618,465 L609,464 L605,396 L628,396Z","AK":"M161,483 L183,483 L183,510 L142,510 L136,493 L161,483Z","AZ":"M205,373 L259,373 L264,445 L215,450 L199,420 L205,373Z","AR":"M556,395 L603,395 L603,443 L556,447 L546,425 L556,395Z","CA":"M120,260 L163,250 L197,370 L168,445 L120,410 L120,260Z","CO":"M280,280 L362,280 L362,340 L280,340 L280,280Z","CT":"M823,205 L847,195 L853,215 L830,222 L823,205Z","DE":"M793,275 L803,265 L810,285 L798,290 L793,275Z","FL":"M635,453 L700,440 L725,485 L690,530 L652,510 L635,465 L635,453Z","GA":"M650,380 L698,370 L710,438 L660,450 L635,420 L650,380Z","HI":"M285,495 L315,490 L320,510 L290,515 L285,495Z","ID":"M215,140 L258,138 L268,240 L228,260 L210,200 L215,140Z","IL":"M572,245 L600,238 L610,340 L580,355 L560,310 L572,245Z","IN":"M610,253 L640,250 L645,340 L615,348 L605,300 L610,253Z","IA":"M500,225 L566,220 L570,275 L505,280 L495,250 L500,225Z","KS":"M385,310 L490,305 L490,358 L385,362 L385,310Z","KY":"M608,330 L700,310 L705,348 L618,365 L608,330Z","LA":"M545,448 L590,445 L598,495 L555,500 L537,475 L545,448Z","ME":"M845,100 L870,90 L882,160 L850,170 L838,130 L845,100Z","MD":"M753,272 L800,260 L805,290 L765,300 L753,272Z","MA":"M830,188 L870,180 L872,198 L838,205 L830,188Z","MI":"M590,155 L645,140 L660,220 L620,248 L590,200 L590,155Z","MN":"M485,120 L548,115 L555,210 L492,215 L480,165 L485,120Z","MS":"M580,400 L608,395 L615,465 L585,470 L575,435 L580,400Z","MO":"M510,300 L580,290 L590,375 L520,385 L505,340 L510,300Z","MT":"M240,100 L355,95 L358,170 L248,175 L235,135 L240,100Z","NE":"M370,250 L485,245 L490,300 L375,305 L365,275 L370,250Z","NV":"M160,235 L210,228 L220,350 L170,365 L155,300 L160,235Z","NH":"M842,120 L858,115 L862,175 L845,180 L842,120Z","NJ":"M798,235 L815,225 L820,275 L800,280 L795,255 L798,235Z","NM":"M245,375 L330,370 L338,455 L253,460 L245,375Z","NY":"M750,145 L830,130 L845,215 L782,235 L750,195 L750,145Z","NC":"M670,345 L775,325 L785,358 L688,378 L670,345Z","ND":"M380,115 L480,110 L485,170 L382,175 L380,115Z","OH":"M645,245 L700,235 L708,310 L652,320 L645,245Z","OK":"M375,365 L495,358 L500,410 L440,425 L380,420 L375,365Z","OR":"M120,130 L215,120 L220,220 L130,235 L115,180 L120,130Z","PA":"M710,215 L798,200 L805,260 L720,275 L710,215Z","RI":"M848,200 L858,196 L860,212 L850,215 L848,200Z","SC":"M680,375 L730,360 L740,400 L695,415 L680,375Z","SD":"M380,175 L480,170 L485,230 L385,235 L378,200 L380,175Z","TN":"M590,355 L700,340 L705,370 L595,385 L590,355Z","TX":"M335,395 L495,385 L540,490 L460,530 L370,510 L335,465 L335,395Z","UT":"M220,245 L285,240 L290,340 L230,348 L220,245Z","VT":"M828,120 L842,115 L845,175 L832,180 L828,120Z","VA":"M690,300 L790,280 L795,330 L700,350 L690,300Z","WA":"M130,72 L220,65 L225,140 L140,148 L125,110 L130,72Z","WV":"M700,280 L745,268 L752,330 L712,345 L700,280Z","WI":"M540,135 L600,128 L608,225 L548,232 L535,180 L540,135Z","WY":"M265,175 L360,170 L365,248 L270,253 L265,175Z","DC":"M780,290 L786,287 L788,294 L782,296 L780,290Z"};

// ===================== NAVIGATION =====================
document.querySelectorAll('.nav-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    tab.classList.add('active');
    const sec = document.getElementById('section-' + tab.dataset.section);
    if (sec) sec.classList.add('active');
  });
});

// ===================== MODAL =====================
function openModal(id) {
  const c = companies.find(x => x.id === id);
  if (!c) return;
  document.getElementById('modalBody').innerHTML = `
    <div class="modal-header"><div class="modal-company-name" style="color:${c.color};">${c.name}</div><div class="modal-company-type">${c.type}</div></div>
    <div class="modal-grid">
      <div class="modal-stat"><div class="modal-stat-label">Headquarters</div><div class="modal-stat-value">${c.hq}</div></div>
      <div class="modal-stat"><div class="modal-stat-label">Founded</div><div class="modal-stat-value">${c.founded}</div></div>
      <div class="modal-stat"><div class="modal-stat-label">CEO/Leader</div><div class="modal-stat-value" style="font-size:14px;">${c.ceo}</div></div>
      <div class="modal-stat"><div class="modal-stat-label">Headcount</div><div class="modal-stat-value">${c.headcountLabel}</div></div>
      <div class="modal-stat"><div class="modal-stat-label">Est. Revenue</div><div class="modal-stat-value" style="font-size:14px;">${c.revenueRange}</div></div>
      <div class="modal-stat"><div class="modal-stat-label">Ownership</div><div class="modal-stat-value" style="font-size:12px;">${c.ownership}</div></div>
    </div>
    <div class="modal-section-title">Service Offerings</div>
    <div style="display:flex;flex-wrap:wrap;gap:5px;margin-bottom:14px;">${c.services.map(s=>`<span class="company-tag" style="background:${c.color}12;color:${c.color};border-color:${c.color}30;">${s}</span>`).join('')}</div>
    <div class="modal-section-title">Channel Coverage</div>
    <div style="display:flex;flex-wrap:wrap;gap:5px;margin-bottom:14px;">${c.channels.map(ch=>`<span class="company-tag">${ch}</span>`).join('')}</div>
    <div class="modal-section-title">Geographic Reach</div>
    <p style="font-size:14px;color:var(--text-secondary);margin-bottom:14px;">${c.geo}</p>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
      <div><div class="modal-section-title" style="color:var(--accent-green);">Competitive Strengths</div><ul class="modal-list">${c.strengths.map(s=>`<li>${s}</li>`).join('')}</ul></div>
      <div><div class="modal-section-title" style="color:var(--accent-red);">Competitive Weaknesses</div><ul class="modal-list">${c.weaknesses.map(w=>`<li>${w}</li>`).join('')}</ul></div>
    </div>
    <div class="modal-section-title">Recent Strategic Moves</div>
    <ul class="modal-list">${c.recentMoves.map(m=>`<li>${m}</li>`).join('')}</ul>`;
  document.getElementById('companyModal').classList.add('active');
}
document.getElementById('modalClose').addEventListener('click', () => document.getElementById('companyModal').classList.remove('active'));
document.getElementById('companyModal').addEventListener('click', e => { if(e.target===e.currentTarget) e.currentTarget.classList.remove('active'); });

// ===================== RENDER HELPERS =====================
function hbarChart(data, maxVal) {
  return data.map(d => `<div class="hbar-row"><div class="hbar-label">${d.label}</div><div class="hbar-track"><div class="hbar-fill" style="width:${(d.value/maxVal*100).toFixed(1)}%;background:${d.color};">${d.value >= maxVal*0.15 ? d.display : ''}</div></div><div class="hbar-value">${d.display}</div></div>`).join('');
}

function threatDots(val) {
  const colors = {1:'#3b82f6',2:'#22d3ee',3:'#f59e0b',4:'#f97316',5:'#ef4444'};
  let d='';
  for(let i=1;i<=5;i++) d+=`<span style="display:inline-block;width:10px;height:10px;border-radius:50%;margin:0 1px;background:${i<=val?colors[val]:'rgba(255,255,255,0.06)'};"></span>`;
  return d;
}

// ===================== BUILD ALL SECTIONS =====================
function buildApp() {
  const app = document.getElementById('app');
  let html = '';

  // ===== OVERVIEW =====
  const sorted_hc = [...companies].sort((a,b)=>b.headcount-a.headcount);
  const sorted_rev = [...companies].sort((a,b)=>b.revenueMid-a.revenueMid);
  html += `<div class="section active" id="section-overview">
    <div class="section-title">Market Overview</div>
    <div class="section-desc">CPG & Retail Brokerage, Merchandising, and Labor Services -- the competitive landscape has fundamentally reshaped since 2024.</div>
    <div class="grid-4">
      <div class="card animate-in"><div class="stat-mini"><div class="stat-icon" style="background:rgba(59,130,246,0.12);color:var(--accent-blue);">11</div><div class="stat-content"><div class="card-title">Companies Tracked</div><div class="card-value" style="font-size:22px;">3 Tiers</div><div class="card-detail">National | Regional | Specialist</div></div></div></div>
      <div class="card animate-in"><div class="stat-mini"><div class="stat-icon" style="background:rgba(16,185,129,0.12);color:var(--accent-green);">$</div><div class="stat-content"><div class="card-title">Combined Revenue Est.</div><div class="card-value" style="font-size:22px;">$14B+</div><div class="card-detail">U.S. CPG brokerage & retail services</div></div></div></div>
      <div class="card animate-in"><div class="stat-mini"><div class="stat-icon" style="background:rgba(245,158,11,0.12);color:var(--accent-amber);">!</div><div class="stat-content"><div class="card-title">Key Trend</div><div class="card-value" style="font-size:18px;">Duopoly</div><div class="card-detail">Advantage + Acosta/Crossmark control the market</div></div></div></div>
      <div class="card animate-in"><div class="stat-mini"><div class="stat-icon" style="background:rgba(139,92,246,0.12);color:var(--accent-purple);">AI</div><div class="stat-content"><div class="card-title">Tech Disruption</div><div class="card-value" style="font-size:18px;">Robotics</div><div class="card-detail">Computer vision + AI reshaping shelf execution</div></div></div></div>
    </div>
    <div class="grid-2">
      <div class="chart-container"><div class="chart-title">Estimated Scale by Headcount</div><div class="chart-subtitle">Employee / associate count comparison</div><div class="hbar-chart">${hbarChart(sorted_hc.map(c=>({label:c.name,value:c.headcount,display:c.headcountLabel,color:c.color})),sorted_hc[0].headcount)}</div></div>
      <div class="chart-container"><div class="chart-title">Estimated Revenue Range</div><div class="chart-subtitle">Annual revenue estimates ($ millions)</div><div class="hbar-chart">${hbarChart(sorted_rev.map(c=>({label:c.name,value:c.revenueMid,display:c.revenueRange,color:c.color})),sorted_rev[0].revenueMid)}</div></div>
    </div>
    <div class="chart-container"><div class="chart-title">Competitive Tier Structure</div><div class="chart-subtitle">Companies segmented by scale, reach, and service breadth</div>
    <table class="data-table"><thead><tr><th>Tier</th><th>Company</th><th>HQ</th><th>Ownership</th><th>Est. Headcount</th><th>Geographic Reach</th><th>Primary Model</th></tr></thead><tbody>
    ${companies.map(c=>`<tr><td><span class="tier-badge ${c.tier}">${c.tier.replace('-',' ').toUpperCase()}</span></td><td style="font-weight:700;color:${c.color};">${c.name}</td><td>${c.hq}</td><td style="font-size:12px;">${c.ownership}</td><td style="color:${c.color};font-weight:700;">${c.headcountLabel}</td><td>${c.geo}</td><td style="font-size:12px;">${c.type}</td></tr>`).join('')}
    </tbody></table></div>
  </div>`;

  // ===== PLAYER PROFILES =====
  html += `<div class="section" id="section-players">
    <div class="section-title">Player Profiles</div><div class="section-desc">Click any company card for a detailed competitive dossier.</div>
    <div class="filter-bar"><button class="filter-btn active" data-filter="all">All Players</button><button class="filter-btn" data-filter="tier-1">Tier 1 National</button><button class="filter-btn" data-filter="tier-2">Tier 2 Scale</button><button class="filter-btn" data-filter="tier-3">Tier 3 Regional/Specialist</button></div>
    <div class="grid-3" id="playerGrid">
    ${companies.map(c=>`<div class="company-card" data-tier="${c.tier}" style="--card-accent:${c.color};" onclick="openModal('${c.id}')">
      <div class="company-name" style="color:${c.color};">${c.name}</div><div class="company-type">${c.type}</div>
      <div class="company-stats"><div class="stat-item"><div class="stat-label">Headcount</div><div class="stat-val">${c.headcountLabel}</div></div><div class="stat-item"><div class="stat-label">Revenue</div><div class="stat-val" style="font-size:13px;">${c.revenueRange}</div></div><div class="stat-item"><div class="stat-label">Founded</div><div class="stat-val">${c.founded}</div></div></div>
      <div class="company-tags">${c.services.slice(0,3).map(s=>`<span class="company-tag" style="background:${c.color}15;color:${c.color};border-color:${c.color}33;">${s}</span>`).join('')}${c.services.length>3?`<span class="company-tag" style="background:rgba(255,255,255,0.04);color:var(--text-muted);border-color:var(--border-color);">+${c.services.length-3} more</span>`:''}</div>
    </div>`).join('')}
    </div></div>`;

  // ===== COMPETITIVE POSITIONING (SVG-based) =====
  const svgW=700, svgH=460, pad=60;
  function bubbleSVG() {
    let svg = `<svg viewBox="0 0 ${svgW} ${svgH}" class="pos-chart-svg">`;
    // Grid
    svg += `<rect x="${pad}" y="10" width="${svgW-pad-10}" height="${svgH-pad-10}" fill="rgba(0,0,0,0.15)" rx="6"/>`;
    for(let i=0;i<=4;i++){
      const y=10+(svgH-pad-10)*i/4;
      svg+=`<line x1="${pad}" y1="${y}" x2="${svgW-10}" y2="${y}" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>`;
    }
    for(let i=0;i<=4;i++){
      const x=pad+(svgW-pad-10)*i/4;
      svg+=`<line x1="${x}" y1="10" x2="${x}" y2="${svgH-pad+10}" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>`;
    }
    // Axis labels
    svg += `<text x="${svgW/2}" y="${svgH-8}" fill="#5b6b8f" font-size="10" text-anchor="middle" font-weight="600" letter-spacing="1">SERVICE BREADTH (NARROW → FULL SUITE)</text>`;
    svg += `<text x="14" y="${svgH/2-20}" fill="#5b6b8f" font-size="10" text-anchor="middle" font-weight="600" letter-spacing="1" transform="rotate(-90,14,${svgH/2-20})">SCALE (EMPLOYEES)</text>`;
    // Bubbles
    companies.forEach(c => {
      const r = Math.max(12, Math.min(45, Math.sqrt(c.headcount)*0.18));
      const cx = pad + (c.serviceBreadth/100)*(svgW-pad-10-r*2) + r;
      const cy = 10 + (1-c.scaleScore/100)*(svgH-pad-10-r*2) + r;
      svg += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="${c.color}" fill-opacity="0.7" stroke="${c.color}" stroke-width="2" stroke-opacity="0.9" style="cursor:pointer;" onclick="openModal('${c.id}')"><title>${c.name}\nHeadcount: ${c.headcountLabel}\nRevenue: ${c.revenueRange}</title></circle>`;
      svg += `<text x="${cx}" y="${cy+3}" fill="white" font-size="${Math.max(7,r/3.5)}" text-anchor="middle" font-weight="700" pointer-events="none">${c.name.split(' ')[0]}</text>`;
    });
    svg += '</svg>';
    return svg;
  }

  function quadrantSVG() {
    let svg = `<svg viewBox="0 0 ${svgW} ${svgH}" class="pos-chart-svg">`;
    svg += `<rect x="${pad}" y="10" width="${svgW-pad-10}" height="${svgH-pad-10}" fill="rgba(0,0,0,0.15)" rx="6"/>`;
    const midX=pad+(svgW-pad-10)/2, midY=10+(svgH-pad-10)/2;
    svg += `<line x1="${pad}" y1="${midY}" x2="${svgW-10}" y2="${midY}" stroke="rgba(255,255,255,0.08)" stroke-width="1" stroke-dasharray="4"/>`;
    svg += `<line x1="${midX}" y1="10" x2="${midX}" y2="${svgH-pad+10}" stroke="rgba(255,255,255,0.08)" stroke-width="1" stroke-dasharray="4"/>`;
    // Quadrant labels
    svg += `<text x="${pad+12}" y="30" fill="#5b6b8f" font-size="10" font-weight="600" opacity="0.5">NICHE SPECIALISTS</text>`;
    svg += `<text x="${svgW-14}" y="30" fill="#5b6b8f" font-size="10" font-weight="600" text-anchor="end" opacity="0.5">SCALE + SPECIALIZATION</text>`;
    svg += `<text x="${pad+12}" y="${svgH-pad}" fill="#5b6b8f" font-size="10" font-weight="600" opacity="0.5">EMERGING / LOCAL</text>`;
    svg += `<text x="${svgW-14}" y="${svgH-pad}" fill="#5b6b8f" font-size="10" font-weight="600" text-anchor="end" opacity="0.5">NATIONAL GENERALISTS</text>`;
    // Axis labels
    svg += `<text x="${svgW/2}" y="${svgH-8}" fill="#5b6b8f" font-size="10" text-anchor="middle" font-weight="600" letter-spacing="1">NATIONAL REACH →</text>`;
    svg += `<text x="14" y="${svgH/2-20}" fill="#5b6b8f" font-size="10" text-anchor="middle" font-weight="600" letter-spacing="1" transform="rotate(-90,14,${svgH/2-20})">SPECIALIZATION DEPTH →</text>`;
    companies.forEach(c => {
      const cx = pad + (c.nationalReach/100)*(svgW-pad-10);
      const cy = 10 + (1-c.specialization/100)*(svgH-pad-10);
      svg += `<circle cx="${cx}" cy="${cy}" r="8" fill="${c.color}" stroke="white" stroke-width="1.5" stroke-opacity="0.4" style="cursor:pointer;" onclick="openModal('${c.id}')"><title>${c.name}</title></circle>`;
      const labelX = cx + 12;
      const labelY = cy + 4;
      svg += `<text x="${labelX}" y="${labelY}" fill="${c.color}" font-size="10" font-weight="600" pointer-events="none">${c.name}</text>`;
    });
    svg += '</svg>';
    return svg;
  }

  html += `<div class="section" id="section-positioning">
    <div class="section-title">Competitive Positioning</div><div class="section-desc">Strategic mapping across key competitive dimensions.</div>
    <div class="grid-2">
      <div class="chart-container"><div class="chart-title">Scale vs. Service Breadth</div><div class="chart-subtitle">Bubble size = estimated headcount</div>${bubbleSVG()}</div>
      <div class="chart-container"><div class="chart-title">Strategic Positioning Matrix</div><div class="chart-subtitle">National reach vs. specialization depth</div>${quadrantSVG()}</div>
    </div>
    <div class="chart-container" style="margin-bottom:28px;">
      <div class="chart-title">Ownership & Consolidation Map (2026)</div><div class="chart-subtitle">The Acosta Group collective now controls 3 of the 11 tracked entities; Advantage Solutions operates independently as the public-market counterpart</div>
      <div style="display:flex;gap:16px;flex-wrap:wrap;">
        <div style="flex:1;min-width:280px;">
          <div style="background:rgba(231,76,60,0.06);border:1px solid rgba(231,76,60,0.2);border-radius:12px;padding:16px;margin-bottom:10px;">
            <div style="font-size:11px;font-weight:700;color:#e74c3c;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">PUBLIC COMPANY</div>
            <span style="padding:6px 14px;background:rgba(231,76,60,0.15);border-radius:8px;font-size:13px;font-weight:600;color:#e74c3c;">Advantage Solutions (ADV)</span>
          </div>
          <div style="background:rgba(59,130,246,0.06);border:1px solid rgba(59,130,246,0.2);border-radius:12px;padding:16px;margin-bottom:10px;">
            <div style="font-size:11px;font-weight:700;color:var(--accent-blue);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">ACOSTA GROUP COLLECTIVE (PE-BACKED)</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <span style="padding:5px 12px;background:rgba(59,130,246,0.15);border-radius:8px;font-size:12px;font-weight:600;color:var(--accent-blue);">Acosta</span>
              <span style="padding:5px 12px;background:rgba(59,130,246,0.15);border-radius:8px;font-size:12px;font-weight:600;color:var(--accent-blue);">Crossmark</span>
              <span style="padding:5px 12px;background:rgba(59,130,246,0.15);border-radius:8px;font-size:12px;font-weight:600;color:var(--accent-blue);">Product Connections</span>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
            <div style="background:rgba(139,92,246,0.06);border:1px solid rgba(139,92,246,0.2);border-radius:12px;padding:14px;">
              <div style="font-size:10px;font-weight:700;color:var(--accent-purple);margin-bottom:6px;">PE-BACKED</div>
              <span style="padding:4px 10px;background:rgba(139,92,246,0.12);border-radius:6px;font-size:11px;font-weight:600;color:var(--accent-purple);">Driveline</span>
            </div>
            <div style="background:rgba(34,211,238,0.06);border:1px solid rgba(34,211,238,0.2);border-radius:12px;padding:14px;">
              <div style="font-size:10px;font-weight:700;color:var(--accent-cyan);margin-bottom:6px;">VC/PE TECH</div>
              <span style="padding:4px 10px;background:rgba(34,211,238,0.12);border-radius:6px;font-size:11px;font-weight:600;color:var(--accent-cyan);">Trax</span>
            </div>
            <div style="background:rgba(16,185,129,0.06);border:1px solid rgba(16,185,129,0.2);border-radius:12px;padding:14px;">
              <div style="font-size:10px;font-weight:700;color:var(--accent-green);margin-bottom:6px;">FAMILY-OWNED</div>
              <div style="display:flex;flex-wrap:wrap;gap:4px;"><span style="padding:4px 8px;background:rgba(16,185,129,0.12);border-radius:6px;font-size:11px;font-weight:600;color:var(--accent-green);">Empire</span><span style="padding:4px 8px;background:rgba(16,185,129,0.12);border-radius:6px;font-size:11px;font-weight:600;color:var(--accent-green);">JOH</span><span style="padding:4px 8px;background:rgba(16,185,129,0.12);border-radius:6px;font-size:11px;font-weight:600;color:var(--accent-green);">Schraad</span></div>
            </div>
            <div style="background:rgba(245,158,11,0.06);border:1px solid rgba(245,158,11,0.2);border-radius:12px;padding:14px;">
              <div style="font-size:10px;font-weight:700;color:var(--accent-amber);margin-bottom:6px;">CONSORTIUM/STARTUP</div>
              <div style="display:flex;flex-wrap:wrap;gap:4px;"><span style="padding:4px 8px;background:rgba(245,158,11,0.12);border-radius:6px;font-size:11px;font-weight:600;color:var(--accent-amber);">C.A. Fortune</span><span style="padding:4px 8px;background:rgba(245,158,11,0.12);border-radius:6px;font-size:11px;font-weight:600;color:var(--accent-amber);">TruX</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

  // ===== GEOGRAPHIC COVERAGE MAP =====
  html += `<div class="section" id="section-geomap">
    <div class="section-title">Geographic Coverage Map</div><div class="section-desc">Color-coded U.S. coverage by competitor. Hover over any state to see which companies operate there. Companies marked "ALL" have national coverage.</div>
    <div class="chart-container" style="margin-bottom:28px;">
      <div class="chart-title">United States Coverage by Competitor</div>
      <div class="chart-subtitle">States color-coded by competitor density; national players cover all states</div>
      <div class="us-map-container" id="usMapContainer">
        <div class="map-tooltip" id="mapTooltip"></div>
      </div>
      <div class="map-legend" id="mapLegend"></div>
    </div>
    <div class="grid-2">
      <div class="chart-container">
        <div class="chart-title">Coverage Density by State</div><div class="chart-subtitle">Number of tracked competitors with presence per state (sample)</div>
        <div class="hbar-chart" id="stateDensityChart"></div>
      </div>
      <div class="chart-container">
        <div class="chart-title">International Footprint</div><div class="chart-subtitle">Global reach beyond the U.S.</div>
        <table class="data-table" style="font-size:12px;">
          <thead><tr><th>Company</th><th>Intl Presence</th><th>Key Markets</th></tr></thead>
          <tbody>
            <tr><td style="font-weight:600;color:#e74c3c;">Advantage Solutions</td><td>45+ countries</td><td>Costco demos in 12 countries; Daymon global</td></tr>
            <tr><td style="font-weight:600;color:#3b82f6;">Acosta Group</td><td>US, CAN, UK, AU</td><td>Dee Set (UK), historic AU operations</td></tr>
            <tr><td style="font-weight:600;color:#6366f1;">Crossmark</td><td>US, Canada</td><td>Divested AU/NZ in 2019</td></tr>
            <tr><td style="font-weight:600;color:#22d3ee;">Trax</td><td>80+ countries</td><td>Global computer vision platform</td></tr>
            <tr><td style="font-weight:600;color:#8b5cf6;">Driveline</td><td>US only</td><td>All 50 states</td></tr>
            <tr><td style="font-weight:600;color:var(--text-muted);">Others</td><td>US only</td><td>Regional / domestic focused</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>`;

  // ===== CAPABILITY MATRIX =====
  const capDims = ['HQ Sales','Merch','Demo','Digital','Analytics','AI/CV','Foodsvc','Marketing','Intl','Emrg Brand'];
  const capScores = {
    advantage:[5,4,5,4,4,3,3,4,4,2], acosta:[5,5,5,4,4,4,5,4,3,2], crossmark:[5,4,3,3,4,3,2,3,2,1],
    driveline:[0,5,0,2,4,5,0,0,0,0], cafortune:[4,3,2,3,3,2,2,4,1,4], joh:[4,3,1,3,3,1,2,3,0,4],
    schraad:[4,3,1,1,3,1,1,2,0,1], empire:[5,4,1,2,4,3,2,1,0,1], trax:[0,2,0,2,5,5,0,0,5,0],
    productconnections:[0,1,5,3,2,1,0,4,0,1], trux:[0,3,0,1,2,1,0,0,0,0]
  };
  html += `<div class="section" id="section-capabilities">
    <div class="section-title">Capability Heatmap</div><div class="section-desc">Comparative assessment across key service dimensions. Scale: 5 = market leader, 1 = minimal/none.</div>
    <div class="chart-container" style="margin-bottom:28px;overflow-x:auto;">
      <div class="legend"><div class="legend-item"><span class="heat-cell heat-5" style="width:20px;height:16px;font-size:9px;">5</span> Leader</div><div class="legend-item"><span class="heat-cell heat-4" style="width:20px;height:16px;font-size:9px;">4</span> Strong</div><div class="legend-item"><span class="heat-cell heat-3" style="width:20px;height:16px;font-size:9px;">3</span> Moderate</div><div class="legend-item"><span class="heat-cell heat-2" style="width:20px;height:16px;font-size:9px;">2</span> Limited</div><div class="legend-item"><span class="heat-cell heat-1" style="width:20px;height:16px;font-size:9px;">1</span> Minimal</div><div class="legend-item"><span class="heat-cell heat-0" style="width:20px;height:16px;font-size:9px;">--</span> N/A</div></div>
      <table class="heatmap-table"><thead><tr><th></th>${capDims.map(d=>`<th>${d}</th>`).join('')}</tr></thead><tbody>
      ${companies.map(c=>`<tr><td style="color:${c.color};">${c.name}</td>${capScores[c.id].map(s=>`<td><span class="heat-cell ${s===0?'heat-0':'heat-'+s}">${s||'--'}</span></td>`).join('')}</tr>`).join('')}
      </tbody></table>
    </div>
  </div>`;

  // ===== M&A CONSOLIDATION =====
  html += `<div class="section" id="section-consolidation">
    <div class="section-title">M&A & Consolidation Timeline</div><div class="section-desc">The industry has undergone radical consolidation -- understanding the deal flow reveals where the market is heading.</div>
    <div class="grid-2">
      <div class="chart-container"><div class="chart-title">Key Transactions (2019-2026)</div><div class="chart-subtitle">Major deals reshaping the competitive landscape</div>
        <div class="timeline">
          <div class="timeline-item"><div class="timeline-date">Feb 2026</div><div class="timeline-content"><strong>Gemspring Capital</strong> merges FORM + Trax IR, creating combined retail execution + computer vision platform</div></div>
          <div class="timeline-item"><div class="timeline-date">Jan 2026</div><div class="timeline-content"><strong>Acosta + CommerceIQ</strong> strategic alliance for AI-powered intelligent commerce</div></div>
          <div class="timeline-item"><div class="timeline-date">Sep 2025</div><div class="timeline-content"><strong>Driveline + Brain Corp</strong> launch ShelfOptix, first managed robot-powered shelf intelligence service</div></div>
          <div class="timeline-item"><div class="timeline-date">Mar 2025</div><div class="timeline-content"><strong>C.A. Fortune</strong> acquires DirecToHispanic (DTH) for multicultural marketing</div></div>
          <div class="timeline-item"><div class="timeline-date">Sep 2024</div><div class="timeline-content"><strong>Advantage Solutions</strong> comprehensive rebrand; divests Jun Group for $185M + ~$280M in non-core divestitures</div></div>
          <div class="timeline-item"><div class="timeline-date">Jul 2024</div><div class="timeline-content"><strong style="color:var(--accent-cyan);">Acosta Group</strong> acquires <strong>Crossmark + Product Connections</strong> from WIS International -- the defining deal of the decade</div></div>
          <div class="timeline-item"><div class="timeline-date">Mar 2024</div><div class="timeline-content"><strong>C.A. Fortune</strong> merges with SRW Agency; also acquires Gotham by Trax</div></div>
          <div class="timeline-item"><div class="timeline-date">Jan 2024</div><div class="timeline-content"><strong>Advantage Solutions</strong> partners with Genpact + TCS for digital transformation</div></div>
          <div class="timeline-item"><div class="timeline-date">Jan 2020</div><div class="timeline-content"><strong>Acosta</strong> emerges from Chapter 11 bankruptcy, shedding ~$3B in debt</div></div>
          <div class="timeline-item"><div class="timeline-date">Oct 2020</div><div class="timeline-content"><strong>Advantage Solutions</strong> goes public via SPAC merger (Conyers Park II)</div></div>
        </div>
      </div>
      <div class="chart-container"><div class="chart-title">Industry Structure: Before & After</div><div class="chart-subtitle">The market fundamentally reorganized in 2024</div>
        <div style="margin-top:10px;">
          <div style="background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.15);border-radius:10px;padding:16px;margin-bottom:14px;">
            <div style="font-size:12px;font-weight:700;color:var(--accent-red);margin-bottom:10px;">PRE-2024: THREE NATIONAL INDEPENDENTS</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
              <span style="padding:8px 16px;background:rgba(239,68,68,0.12);border-radius:8px;font-size:14px;font-weight:600;color:#fca5a5;">Advantage Solutions</span>
              <span style="padding:8px 16px;background:rgba(239,68,68,0.12);border-radius:8px;font-size:14px;font-weight:600;color:#fca5a5;">Acosta</span>
              <span style="padding:8px 16px;background:rgba(239,68,68,0.12);border-radius:8px;font-size:14px;font-weight:600;color:#fca5a5;">Crossmark</span>
            </div>
          </div>
          <div style="text-align:center;font-size:24px;color:var(--text-muted);padding:8px;">&#8595;</div>
          <div style="background:rgba(16,185,129,0.06);border:1px solid rgba(16,185,129,0.15);border-radius:10px;padding:16px;">
            <div style="font-size:12px;font-weight:700;color:var(--accent-green);margin-bottom:10px;">POST-2024: EFFECTIVE DUOPOLY</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px;">
              <span style="padding:8px 16px;background:rgba(231,76,60,0.15);border-radius:8px;font-size:14px;font-weight:600;color:#e74c3c;">Advantage Solutions (~69K emp, $3.57B rev)</span>
              <span style="padding:8px 16px;background:rgba(59,130,246,0.15);border-radius:8px;font-size:14px;font-weight:600;color:var(--accent-blue);">Acosta Group (~60K emp, $5-8B est rev)</span>
            </div>
            <div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">Combined: ~129K employees, $8.5-11.5B+ revenue. Regional independents and tech disruptors operate in the space they leave behind.</div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

  // ===== TECHNOLOGY =====
  html += `<div class="section" id="section-technology">
    <div class="section-title">Technology & Innovation Landscape</div><div class="section-desc">AI, computer vision, and robotics are fundamentally disrupting how shelf execution and retail intelligence operate.</div>
    <div class="grid-3">
      <div class="card" style="border-left:3px solid var(--accent-cyan);"><div style="font-size:11px;font-weight:700;color:var(--accent-cyan);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Computer Vision / AI</div><div style="font-size:15px;font-weight:700;margin-bottom:8px;">Trax + FORM Merger</div><div style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Gemspring Capital merges Trax IR with FORM (GoSpotCheck) in Feb 2026. Combined platform offers image recognition + field task management. 30 of top 50 global CPGs are customers.</div></div>
      <div class="card" style="border-left:3px solid var(--accent-purple);"><div style="font-size:11px;font-weight:700;color:var(--accent-purple);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Robotics as a Service</div><div style="font-size:15px;font-weight:700;margin-bottom:8px;">Driveline ShelfOptix</div><div style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Partnership with Brain Corp launched Sep 2025. First fully managed robot-powered shelf intelligence service. Targeting thousands of robots by end of 2026.</div></div>
      <div class="card" style="border-left:3px solid #e74c3c;"><div style="font-size:11px;font-weight:700;color:#e74c3c;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Enterprise AI + Automation</div><div style="font-size:15px;font-weight:700;margin-bottom:8px;">Advantage + Genpact</div><div style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Multi-year Genpact deal (Jan 2024) automating order-to-cash, trade management, and EDI. Salesforce-based OMS-as-a-service. Won 2025 Salesforce Partner Innovation Award.</div></div>
    </div>
    <div class="grid-3">
      <div class="card" style="border-left:3px solid var(--accent-blue);"><div style="font-size:11px;font-weight:700;color:var(--accent-blue);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">AI Commerce Platform</div><div style="font-size:15px;font-weight:700;margin-bottom:8px;">Acosta + CommerceIQ</div><div style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Strategic alliance announced Jan 2026 for AI-powered intelligent commerce. Also partnered with Pensa Systems for computer vision.</div></div>
      <div class="card" style="border-left:3px solid var(--accent-amber);"><div style="font-size:11px;font-weight:700;color:var(--accent-amber);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Private Brand Tech</div><div style="font-size:15px;font-weight:700;margin-bottom:8px;">Advantage Daymon</div><div style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Daymon division uses proprietary AI/ML for private brand strategy and development. Aligned with the accelerating retailer private label trend (40%+ of grocery in EU).</div></div>
      <div class="card" style="border-left:3px solid var(--accent-green);"><div style="font-size:11px;font-weight:700;color:var(--accent-green);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Retail Media</div><div style="font-size:15px;font-weight:700;margin-bottom:8px;">Multiple Players</div><div style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Advantage launching retail media at scale (2025). Acosta adding retail media as a service. $50B+ retail media market creates new revenue stream for intermediaries.</div></div>
    </div>
  </div>`;

  // ===== WORKFORCE =====
  html += `<div class="section" id="section-workforce">
    <div class="section-title">Workforce & Business Model Comparison</div><div class="section-desc">How each company creates value -- workforce structure, revenue model, and competitive moat.</div>
    <div class="grid-3" style="margin-bottom:28px;">
      <div class="card" style="border-top:3px solid var(--accent-blue);"><div style="font-size:11px;font-weight:700;color:var(--accent-blue);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Commission Brokerage</div><div style="font-size:14px;font-weight:600;margin-bottom:6px;">Advantage, Acosta, Crossmark, JOH, Schraad, C.A. Fortune, Empire</div><div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">Earn commissions (1-5%) on CPG manufacturer sales to retailers. Revenue tied to volume. Capital-light but margin-pressured.</div></div>
      <div class="card" style="border-top:3px solid var(--accent-purple);"><div style="font-size:11px;font-weight:700;color:var(--accent-purple);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Retail Labor Services</div><div style="font-size:14px;font-weight:600;margin-bottom:6px;">Driveline, TruX, Product Connections</div><div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">Fee-for-service: charge per project, store visit, or demo event. Higher gross revenue but thinner margins due to workforce costs.</div></div>
      <div class="card" style="border-top:3px solid var(--accent-cyan);"><div style="font-size:11px;font-weight:700;color:var(--accent-cyan);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Technology / SaaS</div><div style="font-size:14px;font-weight:600;margin-bottom:6px;">Trax, Driveline (SmartPMX), ShelfOptix</div><div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">Subscription or usage-based pricing for software, image recognition, and robotics-as-a-service. Highest margin potential.</div></div>
    </div>
  </div>`;

  // ===== STRATEGIC IMPLICATIONS =====
  const overallColors = {'Low':'var(--accent-green)','Moderate':'var(--accent-amber)','High':'var(--accent-orange)','Critical':'var(--accent-red)'};
  const sorted_threat = [...companies].sort((a,b)=>{const o={'Critical':4,'High':3,'Moderate':2,'Low':1};return o[b.threatOverall]-o[a.threatOverall];});
  html += `<div class="section" id="section-strategic">
    <div class="section-title">Strategic Implications</div><div class="section-desc">Key takeaways and discussion points for the leadership team.</div>
    <div class="swot-grid" style="margin-bottom:28px;">
      <div class="swot-card swot-strengths"><h3>Market Opportunities</h3><ul>
        <li>Regional independents offer differentiated alternatives as brands push back against the national duopoly</li>
        <li>Emerging brand incubation growing -- C.A. Fortune and JOH investing here</li>
        <li>Multicultural marketing underserved -- C.A. Fortune's DTH acquisition is first-mover</li>
        <li>Tech-first operators can disintermediate traditional labor-heavy models</li>
        <li>Advantage Solutions' financial distress could create client and talent opportunities</li>
      </ul></div>
      <div class="swot-card swot-threats"><h3>Market Threats</h3><ul>
        <li>Acosta Group's aggressive M&A creates gravitational force absorbing Tier 2-3 players</li>
        <li>Commission compression continues -- large CPGs push rates below 1%</li>
        <li>AI and robotics could eliminate 20-40% of field merchandising labor within 5 years</li>
        <li>Advantage Solutions at $0.87/share could be acquired, changing the duopoly dynamic</li>
        <li>CPG brands increasingly building in-house capabilities, reducing broker role</li>
      </ul></div>
      <div class="swot-card swot-opportunities"><h3>Key Discussion Questions</h3><ul>
        <li>How do we position relative to the Advantage-Acosta duopoly?</li>
        <li>What is our technology investment thesis: build, partner, or acquire?</li>
        <li>Should we pursue retailer-specific specialization (Empire model) or broad coverage?</li>
        <li>Is the OSMG-style consortium model a viable path to national scale?</li>
        <li>If Advantage Solutions goes through restructuring, what assets would we target?</li>
      </ul></div>
      <div class="swot-card swot-weaknesses"><h3>Critical Watch Items</h3><ul>
        <li>Advantage Solutions financial health -- Altman Z-Score near zero, stock at $0.87</li>
        <li>Acosta Group integration execution -- fumble creates opportunity for alternatives</li>
        <li>Trax/FORM merger -- combined platform could become standard tech layer</li>
        <li>Driveline ownership change (Apr 2025) -- new owner could accelerate or pivot</li>
        <li>C.A. Fortune's rapid acquisition pace -- 5 deals in 18 months</li>
      </ul></div>
    </div>
    <div class="chart-container"><div class="chart-title">Competitive Threat Assessment Summary</div><div class="chart-subtitle">Relative competitive pressure across key dimensions (February 2026)</div>
    <table class="data-table"><thead><tr><th>Company</th><th>Scale</th><th>Tech</th><th>M&A</th><th>Client Overlap</th><th>Talent Risk</th><th>Overall</th></tr></thead><tbody>
    ${sorted_threat.map(c=>`<tr><td style="font-weight:700;color:${c.color};">${c.name}</td><td>${threatDots(c.threatScale)}</td><td>${threatDots(c.threatTech)}</td><td>${threatDots(c.threatMA)}</td><td>${threatDots(c.threatClient)}</td><td>${threatDots(c.threatTalent)}</td><td><span style="padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;background:${overallColors[c.threatOverall]}18;color:${overallColors[c.threatOverall]};border:1px solid ${overallColors[c.threatOverall]}40;">${c.threatOverall}</span></td></tr>`).join('')}
    </tbody></table></div>
  </div>`;

  // ===== EXECUTIVE SUMMARY =====
  html += `<div class="section" id="section-executive">
    <div class="section-title">Executive Summary</div><div class="section-desc">Synthesized findings for leadership discussion.</div>
    <div class="grid-3" style="margin-bottom:28px;">
      <div class="card" style="border-left:4px solid var(--accent-red);"><div style="font-size:11px;font-weight:700;color:var(--accent-red);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Insight #1</div><div style="font-size:16px;font-weight:700;margin-bottom:8px;">The Duopoly Is Real</div><div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">Advantage Solutions ($3.57B, 69K employees) and Acosta Group ($5-8B est, 60K employees) together field ~129K associates across 100K+ retail locations. Everyone else competes in the space they leave behind.</div></div>
      <div class="card" style="border-left:4px solid var(--accent-cyan);"><div style="font-size:11px;font-weight:700;color:var(--accent-cyan);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Insight #2</div><div style="font-size:16px;font-weight:700;margin-bottom:8px;">Technology Is the Wedge</div><div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">Three technology bets are reshaping the industry: Trax/FORM computer vision, Driveline ShelfOptix robotics, and Advantage's Genpact AI automation. The tech layer winner could disintermediate traditional labor models.</div></div>
      <div class="card" style="border-left:4px solid var(--accent-amber);"><div style="font-size:11px;font-weight:700;color:var(--accent-amber);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Insight #3</div><div style="font-size:16px;font-weight:700;margin-bottom:8px;">Advantage Is Vulnerable</div><div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">Despite being the largest by reported revenue, Advantage Solutions is in financial distress: $378M net loss, stock at $0.87, net leverage 4.4x. A restructuring event could reshape the entire competitive landscape.</div></div>
    </div>
    <div class="chart-container"><div class="chart-title">Recommended 90-Day Priority Actions</div><div class="chart-subtitle">Immediate next steps based on this competitive analysis</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:14px;">
        <div style="background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.15);border-radius:10px;padding:16px;"><div style="font-size:11px;font-weight:700;color:var(--accent-red);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Immediate (0-30 Days)</div><ul style="list-style:none;font-size:13px;color:var(--text-secondary);"><li style="padding:4px 0;display:flex;gap:8px;"><span style="color:var(--accent-red);font-weight:700;">1.</span> Monitor Advantage Solutions financial health and identify their at-risk client relationships</li><li style="padding:4px 0;display:flex;gap:8px;"><span style="color:var(--accent-red);font-weight:700;">2.</span> Map technology stack against Driveline/Trax capabilities -- identify critical gaps</li><li style="padding:4px 0;display:flex;gap:8px;"><span style="color:var(--accent-red);font-weight:700;">3.</span> Contact displaced Crossmark clients exploring alternatives post-Acosta integration</li></ul></div>
        <div style="background:rgba(245,158,11,0.06);border:1px solid rgba(245,158,11,0.15);border-radius:10px;padding:16px;"><div style="font-size:11px;font-weight:700;color:var(--accent-amber);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Near-Term (30-60 Days)</div><ul style="list-style:none;font-size:13px;color:var(--text-secondary);"><li style="padding:4px 0;display:flex;gap:8px;"><span style="color:var(--accent-amber);font-weight:700;">4.</span> Develop technology partnership strategy -- build vs. partner vs. acquire</li><li style="padding:4px 0;display:flex;gap:8px;"><span style="color:var(--accent-amber);font-weight:700;">5.</span> Evaluate OSMG or similar consortium for geographic expansion</li><li style="padding:4px 0;display:flex;gap:8px;"><span style="color:var(--accent-amber);font-weight:700;">6.</span> Benchmark talent compensation against low-turnover models (Empire, Driveline)</li></ul></div>
        <div style="background:rgba(16,185,129,0.06);border:1px solid rgba(16,185,129,0.15);border-radius:10px;padding:16px;"><div style="font-size:11px;font-weight:700;color:var(--accent-green);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Strategic (60-90 Days)</div><ul style="list-style:none;font-size:13px;color:var(--text-secondary);"><li style="padding:4px 0;display:flex;gap:8px;"><span style="color:var(--accent-green);font-weight:700;">7.</span> Select target strategic archetype and develop 3-year roadmap</li><li style="padding:4px 0;display:flex;gap:8px;"><span style="color:var(--accent-green);font-weight:700;">8.</span> Identify potential M&A targets -- especially if Advantage restructures</li><li style="padding:4px 0;display:flex;gap:8px;"><span style="color:var(--accent-green);font-weight:700;">9.</span> Present competitive strategy to full leadership team with investment requirements</li></ul></div>
      </div>
    </div>
  </div>`;

  app.innerHTML = html;

  // Post-render: filters
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const f = btn.dataset.filter;
      document.querySelectorAll('.company-card').forEach(card => { card.style.display = (f==='all'||card.dataset.tier===f)?'':'none'; });
    });
  });

  // Render US Map
  renderUSMap();
  renderStateDensity();
}

// ===================== US MAP =====================
function renderUSMap() {
  const container = document.getElementById('usMapContainer');
  const tooltip = document.getElementById('mapTooltip');

  // Compute coverage per state
  const stateCoverage = {};
  allStates.forEach(st => {
    stateCoverage[st] = companies.filter(c => c.states.includes('ALL') || c.states.includes(st));
  });

  // For coloring: find the most distinctive non-national company per state, or blend
  function stateColor(st) {
    const comps = stateCoverage[st];
    const nationals = comps.filter(c => c.states.includes('ALL'));
    const regionals = comps.filter(c => !c.states.includes('ALL'));
    if (regionals.length > 0) {
      // Mix: brighter = more coverage
      const intensity = Math.min(1, 0.3 + regionals.length * 0.2);
      return regionals[0].color + Math.round(intensity * 255).toString(16).padStart(2,'0');
    }
    // National only
    const count = nationals.length;
    const alpha = Math.min(1, 0.15 + count * 0.08);
    return `rgba(59,130,246,${alpha})`;
  }

  let svg = `<svg viewBox="80 50 830 490" style="width:100%;height:auto;">`;
  Object.entries(statePaths).forEach(([st, path]) => {
    const fill = stateColor(st);
    svg += `<path d="${path}" fill="${fill}" data-state="${st}"/>`;
  });
  svg += '</svg>';
  container.insertAdjacentHTML('afterbegin', svg);

  // Legend
  const legendEl = document.getElementById('mapLegend');
  const regionalCompanies = companies.filter(c => !c.states.includes('ALL'));
  const nationalCompanies = companies.filter(c => c.states.includes('ALL'));
  let legendHtml = `<div class="map-legend-item"><div class="map-legend-swatch" style="background:rgba(59,130,246,0.5);"></div>National coverage only (${nationalCompanies.length} companies)</div>`;
  regionalCompanies.forEach(c => {
    legendHtml += `<div class="map-legend-item"><div class="map-legend-swatch" style="background:${c.color};"></div>${c.name} (${c.states.length} states)</div>`;
  });
  legendEl.innerHTML = legendHtml;

  // Tooltip interaction
  container.querySelectorAll('path').forEach(pathEl => {
    pathEl.addEventListener('mouseenter', e => {
      const st = pathEl.dataset.state;
      const comps = stateCoverage[st] || [];
      let ttHtml = `<div style="font-weight:700;margin-bottom:6px;color:var(--text-primary);">${stateNames[st] || st}</div>`;
      ttHtml += `<div style="font-size:11px;color:var(--text-muted);margin-bottom:6px;">${comps.length} competitor${comps.length!==1?'s':''} present</div>`;
      comps.forEach(c => {
        const isNat = c.states.includes('ALL');
        ttHtml += `<div style="display:flex;align-items:center;gap:6px;padding:2px 0;"><span style="width:8px;height:8px;border-radius:50%;background:${c.color};flex-shrink:0;"></span><span style="font-size:11px;color:var(--text-secondary);">${c.name}${isNat?' (national)':''}</span></div>`;
      });
      tooltip.innerHTML = ttHtml;
      tooltip.style.display = 'block';
    });
    pathEl.addEventListener('mousemove', e => {
      const rect = container.getBoundingClientRect();
      tooltip.style.left = (e.clientX - rect.left + 15) + 'px';
      tooltip.style.top = (e.clientY - rect.top - 10) + 'px';
    });
    pathEl.addEventListener('mouseleave', () => { tooltip.style.display = 'none'; });
  });
}

function renderStateDensity() {
  const container = document.getElementById('stateDensityChart');
  const sampleStates = ['TX','OH','VA','MA','FL','OK','CT','GA','NY','CA'];
  const data = sampleStates.map(st => {
    const count = companies.filter(c => c.states.includes('ALL') || c.states.includes(st)).length;
    return { label: stateNames[st], value: count, display: count + ' companies', color: count >= 8 ? '#3b82f6' : count >= 7 ? '#22d3ee' : '#f59e0b' };
  }).sort((a,b) => b.value - a.value);
  container.innerHTML = hbarChart(data, 11);
}

// ===================== INIT =====================
buildApp();
</script>
</body>
</html>
